<!-- 85a8b69c-fe6e-4129-bbdb-3e25e03d3682 c204dc13-ff28-44eb-83c2-2cd2a2ec7df0 -->
# 優先度付きロードマップ（カテゴリ・日付拡張なし方針）

## 方針

- カテゴリは導入しない
- 締め日・支払日以外の日時（日付/日次）は導入しない（年・月粒度を継続）

## 1. 保存基盤の強化（最優先）

- Drift/SQLiteを導入し、Repositoryパターンで`application`→`infrastructure`の依存を抽象化
- 目的: 高速な検索/集計、マイグレーション容易化、データ増加に強い構成
- 対応: DBスキーマ（cards, transactions）、DAO・Repository層、SharedPreferencesからの一括移行

## 2. 締め日基準の請求月集計

- カードごとの`closingDay`/`paymentDay`に基づき、請求月を推定
- ホーム/カード詳細/折れ線グラフで「請求月ベース」の合計・推移を表示切替（設定トグル）
- 境界条件: 締め日末尾超過（30/31）や2月、月跨ぎロジックのユニットテスト整備

## 3. 可視化拡充（カテゴリ無し）

- カード比較棒グラフ（当月/選択月での各カード合計比較）
- 月次予算バー（設定した予算に対する進捗ゲージ）

## 4. 予算/通知

- カード別/全体の月次予算設定
- 予算超過時のローカル通知、支払日前のリマインド通知

## 5. セキュリティ/バックアップ

- アプリロック（PIN/生体認証）
- データ暗号化（SQLite/バックアップ）
- ローカル/クラウドバックアップ（ファイルエクスポート/インポートに限定。クラウドは利用者選択）

## 6. テスト/CI

- 請求月集計・予算計算ロジックのユニットテスト
- 主要画面のWidgetテスト（年選択/集計切替/グラフ表示）
- CI（analyze/test/build）導入

---

### 実装対象の主なファイル

- `lib/features/cards/infrastructure/`（Drift DB, DAO, Repositories）
- `lib/features/cards/application/`（Provider→UseCase層分割、Repository利用）
- `lib/features/cards/presentation/screens/`（UI更新: 集計切替、比較グラフ、予算UI）
- `lib/shared/`（フォーマッタ、通知、セキュリティ、バックアップユーティリティ）

### To-dos

- [ ] Drift/SQLite導入・DBスキーマ/DAO/Repository実装・移行実装
- [ ] 締め日基準の請求月集計ロジックを実装し表示切替に対応
- [ ] カード比較棒グラフを実装（当月/選択月比較）
- [ ] 月次予算設定と進捗バー表示を実装
- [ ] 予算超過と支払日前のローカル通知を実装
- [ ] PIN/生体認証ロックとデータ暗号化を実装
- [ ] ローカル/クラウド向けバックアップ・復元ユーティリティを実装
- [ ] ユニット/Widgetテスト追加とCI導入
